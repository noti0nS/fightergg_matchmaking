CREATE TABLE IF NOT EXISTS GAMES (
  ID SERIAL PRIMARY KEY,
  TITULO VARCHAR(64) NOT NULL,
  DESCRICAO VARCHAR(255),
  CONSTRAINT UQ_GAMES_TITULO UNIQUE (TITULO)
);
CREATE TABLE IF NOT EXISTS USUARIOS (
  ID SERIAL PRIMARY KEY,
  NOME_COMPLETO VARCHAR(128) NOT NULL,
  NICKNAME VARCHAR(32) NOT NULL,
  EMAIL VARCHAR(150) NOT NULL,
  SENHA VARCHAR(96) NOT NULL,
  BALANCE NUMERIC(12, 2) NOT NULL DEFAULT 0,
  CONSTRAINT UQ_USUARIOS_NICKNAME UNIQUE (NICKNAME),
  CONSTRAINT UQ_USUARIOS_EMAIL UNIQUE (EMAIL)
);
CREATE TABLE IF NOT EXISTS EVENTOS (
  ID SERIAL PRIMARY KEY,
  OWNER_ID INT REFERENCES USUARIOS (ID),
  GAME_ID INT REFERENCES GAMES (ID),
  WINNER_ID INT,
  TITULO VARCHAR(80) NOT NULL,
  DESCRICAO VARCHAR(255) NOT NULL,
  DATA_INICIO DATE NOT NULL,
  DATA_FIM DATE NOT NULL,
  QTD_PLAYERS INT NOT NULL,
  VALOR_RECOMPENSA NUMERIC(12, 2) NOT NULL DEFAULT 0,
  CONSTRAINT UQ_EVENTOS_TITULO UNIQUE (TITULO)
);
CREATE TABLE IF NOT EXISTS EVENTOS_TICKETS (
  ID SERIAL PRIMARY KEY,
  EVENTO_ID INT REFERENCES EVENTOS (ID) ON DELETE CASCADE,
  USUARIO_ID INT REFERENCES USUARIOS (ID)
);
CREATE TABLE IF NOT EXISTS EVENTOS_PARTIDAS (
  ID SERIAL PRIMARY KEY,
  EVENTO_ID INT REFERENCES EVENTOS (ID) ON DELETE CASCADE,
  PLAYER1_ID INT,
  PLAYER2_ID INT,
  WINNER_ID INT,
  NEXT_MATCH_ID INT,
  ROUND INT NOT NULL DEFAULT 1
);